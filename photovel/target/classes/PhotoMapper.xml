<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PhotoMapper">
  <insert id="insertPhoto" parameterType="Photo">
  	<selectKey keyProperty="content_id" resultType="int" order="BEFORE">
  	  <!-- content번호 최대값 반환, 없으면 null대신 0 반환 -->
  	  SELECT IFNULL(MAX(content_id), 0) FROM content
  	</selectKey>
    INSERT INTO photo VALUES(#{content_id}, #{content_detail_id}, #{photo_file_name}, #{photo_top_flag}, #{photo_date}, #{photo_latitude}, #{photo_longitude})
  </insert>
  <select id="selectAll" resultType="Photo">
    SELECT * FROM photo
  </select>
  <select id="selectByContentId" parameterType="int" resultType="Photo">
   SELECT photo_file_name, photo_date, photo_latitude, photo_longitude
   FROM photo p JOIN content_detail cd ON p.content_detail_id = cd.content_detail_id 
   WHERE content_id = #{content_id}
  </select>
  <update id="updatePhoto" parameterType="Photo">
    UPDATE photo SET 
	<set>
		<if test="photo_top_flag != null">photo_top_flag=#{photo_top_flag},</if>
		<if test="photo_date != null">photo_date=#{photo_date},</if>
		<if test="photo_latitude != null">photo_latitude=#{photo_latitude},</if>
		<if test="photo_logitude != null">photo_logitude=#{photo_logitude}</if>
	</set>
	WHERE content_detail_id = #{content_detail_id}
  </update>
</mapper>